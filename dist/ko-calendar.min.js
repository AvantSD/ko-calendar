/*! ko-calendar */
(function(){var a="calendar",b={deepExtend:function(a,c){var d;for(d in c)c[d]&&c[d].constructor&&c[d].constructor===Object?(a[d]=a[d]||{},b.deepExtend(a[d],c[d])):a[d]=c[d];return a}},c=function(c){var d=this;return d.opts={value:ko.observable(),current:new Date,selected:null,deselectable:!0,showCalendar:!0,showToday:!0,showTime:!0,showNow:!0,militaryTime:!1,min:null,max:null,strings:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],time:["AM","PM"]}},b.deepExtend(d.opts,c),d.opts.showCalendar||d.opts.showTime?(d.constants={daysInWeek:7,dayStringLength:2},d.utils={date:{normalize:function(a){var b=new Date(a.getTime());return b.setHours(0,0,0,0),b},isSame:function(a,b){return a&&b?a.getMonth()==b.getMonth()&&a.getDate()==b.getDate()&&a.getFullYear()==b.getFullYear():!1},isSameMonth:function(a,b){return a&&b?a.getMonth()==b.getMonth():!1},isWeekend:function(a){return a?0===a.getDay()||a.getDay()==d.constants.daysInWeek-1:!1},isWithinMinMaxDateRange:function(a){return a?d.opts.min||d.opts.max?d.opts.min&&d.utils.date.normalize(d.opts.min)>a?!1:d.opts.max&&d.utils.date.normalize(d.opts.max)<a?!1:!0:!0:!1}},time:{handleSuffixCheck:function(a){var b=a.getHours();return b>=12?b-=12:12>b&&(b+=12),a.setHours(b)},checkMinTimeRange:function(a){if(!a||!d.selected()||!d.opts.min&&!d.opts.max)return!1;var b=new Date(d.selected());return"hours"===a.type?b.setHours(b.getHours()-1):"minutes"===a.type?b.setMinutes(b.getMinutes()-1):"suffix"===a.type&&(b=d.utils.time.handleSuffixCheck(b)),d.opts.max&&d.opts.max<b?!0:d.opts.min&&d.opts.min>b?!0:!1},checkMaxTimeRange:function(a){if(!a||!d.selected()||!d.opts.min&&!d.opts.max)return!1;var b=new Date(d.selected());return"hours"===a.type?b.setHours(b.getHours()+1):"minutes"===a.type?b.setMinutes(b.getMinutes()+1):"suffix"===a.type&&(b=new Date(d.utils.time.handleSuffixCheck(b))),d.opts.min&&d.opts.min>b?!0:d.opts.max&&d.opts.max<b?!0:!1}},strings:{pad:function(a){return 10>a?"0"+a:a}},element:{offset:function(a){var b=a.getBoundingClientRect(),c=document.documentElement;return{top:b.top+window.pageYOffset-c.clientTop,left:b.left+window.pageXOffset-c.clientLeft}},height:function(a){return a.offsetHeight},isDescendant:function(a,b){for(var c=b.parentNode;null!==c;){if(c==a)return!0;c=c.parentNode}return!1}}},d.current=ko.observable(d.opts.current||new Date),d.selected=ko.observable(d.opts.selected),d.selected.subscribe(d.opts.value),d.opts.value(d.opts.selected),d.opts.showToday&&!d.utils.date.isWithinMinMaxDateRange(d.utils.date.normalize(new Date))&&(d.opts.showToday=!1),d.opts.showNow&&(d.opts.min&&d.opts.min>=new Date||d.opts.max&&d.opts.max<=new Date)&&(d.opts.showNow=!1),d.calendar={select:function(a){return d.opts.deselectable&&d.utils.date.isSame(d.selected(),a)?d.selected(null):void d.selected(new Date(d.opts.min&&d.utils.date.isSame(a,d.opts.min)?d.opts.min:a))},selectToday:function(){var a=d.utils.date.normalize(new Date);d.calendar.select(a),d.current(a)},next:function(){d.current(new Date(d.current().setMonth(d.current().getMonth()+1)))},prev:function(){d.current(new Date(d.current().setMonth(d.current().getMonth()-1)))},sheet:ko.computed(function(){var a=d.utils.date.normalize(d.current());a.setDate(1),a.setDate(a.getDate()-a.getDay());for(var b=[],c=0,e=!1,f=!1,g=!1;;){if(b[c]||(b[c]=[]),b[c].length!==d.constants.daysInWeek&&(b[c].push(new Date(a.getTime())),a.setDate(a.getDate()+1)),a.getMonth()==d.current().getMonth()&&(e=!0),e&&a.getMonth()!==d.current().getMonth()&&(f=!0),f&&b[c].length==d.constants.daysInWeek&&(g=!0),f&&g)break;b[c].length==d.constants.daysInWeek&&c++}return b})},d.time={next:function(a){return d.selected()?void d.selected(new Date(a.set(a.get()+1))):d.time.selectNow()},prev:function(a){return d.selected()?void d.selected(new Date(a.set(a.get()-1))):d.time.selectNow()},selectNow:function(){var a=new Date;d.selected(a),d.current(a)},sheet:ko.observableArray([{type:"hours",get:function(){return d.selected().getHours()},set:function(a){return d.selected().setHours(a)}},{type:"minutes",get:function(){return d.selected().getMinutes()},set:function(a){return d.selected().setMinutes(a)}}]),text:function(a){if(!d.selected())return"-";switch(a.type){case"suffix":return a.get()?d.opts.strings.time[1]:d.opts.strings.time[0];case"hours":var b=a.get();return!d.opts.militaryTime&&(b>12||0===b)&&(b-=12),Math.abs(b);default:return d.utils.strings.pad(a.get())}}},d.opts.militaryTime||d.time.sheet.push({type:"suffix",get:function(){return d.selected()&&d.selected().getHours()<12?0:1},set:function(){var a=d.selected().getHours();return a>=12?a-=12:12>a&&(a+=12),d.selected().setHours(a)}}),void(d.visible=ko.observable(!0))):void console.error("Silly goose, what are you using ko-%s for?",a)},d='<div class="ko-calendar" data-bind="with: $data, visible: (opts.showCalendar || opts.showTime && visible(), attr: { \'data-opts\': JSON.stringify(opts) } ">			<!-- ko if: opts.showCalendar -->			<table data-bind="css: { selected: selected } " class="calendar-sheet">				<thead>					<tr>						<th>							<a href="#" data-bind="click: calendar.prev" class="prev">&laquo;</a>						</th>						<th data-bind="attr: { colspan: constants.daysInWeek - 2 } ">							<b data-bind="text: opts.strings.months[current().getMonth()] + \' \' + current().getFullYear()"></b>						</th>						<th>							<a href="#" data-bind="click: calendar.next" class="next">&raquo;</a>						</th>					</tr>					<tr data-bind="foreach: opts.strings.days">						<th data-bind="text: $data.substring(0, $parents[1].constants.dayStringLength)"></th>					</tr>				</thead>				<tbody data-bind="foreach: calendar.sheet">					<tr class="week" data-bind="foreach: $data">						<td class="day" data-bind="css: { weekend: $parents[1].utils.date.isWeekend($data), today: $parents[1].utils.date.isSame(new Date(), $data), inactive: !($parents[1].utils.date.isSameMonth($parents[1].current(), $data)), outofrange: !($parents[1].utils.date.isWithinMinMaxDateRange($data)) } ">							<a href="javascript:;" data-bind="text: $data.getDate(), attr: { title: $data }, click: $parents[1].calendar.select, css: { active: $parents[1].utils.date.isSame($parents[1].selected(), $data) } "></a>						</td>					</tr>				</tbody>				<!-- ko if: opts.showToday -->					<tfoot>						<tr>							<td data-bind="attr: { colspan: constants.daysInWeek } ">								<a href="javascript:;" data-bind="click: calendar.selectToday">Today</a>							</td>						</tr>					</tfoot>				<!-- /ko -->			</table>			<!-- /ko -->			<!-- ko if: opts.showTime -->			<table class="time-sheet">				<tbody>					<tr data-bind="foreach: time.sheet">						<td data-bind="css: { outofrange: $parent.utils.time.checkMaxTimeRange($data) }">							<a href="#" class="up" data-bind="click: $parent.time.next"></a>						</td>					</tr>					<tr data-bind="foreach: time.sheet">						<td data-bind="css: { colon: $index() === 0, inactive: !$parent.selected() }, text: $parent.time.text($data)"></td>					</tr>					<tr data-bind="foreach: time.sheet">						<td data-bind="css: { outofrange: $parent.utils.time.checkMinTimeRange($data) }">							<a href="#" class="down" data-bind="click: $parent.time.prev"></a>						</td>					</tr>				</tbody>				<!-- ko if: opts.showNow -->					<tfoot>						<tr>							<td data-bind="attr: { colspan: time.sheet().length } ">								<a href="javascript:;" data-bind="click: time.selectNow">Now</a>							</td>						</tr>					</tfoot>				<!-- /ko -->			</table>			<!-- /ko -->		</div>';ko.components.register(a,{viewModel:c,template:d}),ko.bindingHandlers[a]={init:function(a,b){var e,f=ko.unwrap(b()),g=new c(f);if("INPUT"==a.tagName){var h=document.createElement("div");h.innerHTML=d,e=h.children[0],a.parentNode.insertBefore(e,a.nextSibling),g.visible(!1),ko.utils.registerEventHandler(a,"focus",function(){var b=g.utils.element.offset(a),c=g.utils.element.height(a);e.style.position="absolute",e.style.top=b.top+c+5+"px",e.style.left=b.left+"px",g.visible(!0)}),ko.utils.registerEventHandler(document,"mousedown",function(b){b.target==a||b.target==e||g.utils.element.isDescendant(e,b.target)?a.focus():g.visible(!1)})}else a.innerHTML=d,e=a.children[0];return ko.applyBindings(g,e),{controlsDescendantBindings:!0}}}}).call(this);