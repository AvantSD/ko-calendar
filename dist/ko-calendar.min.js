/*! ko-calendar */
(function(){var a="calendar",b=function(a){var b=this;return b.opts={value:ko.observable(),current:new Date,selected:null,deselectable:!0,showCalendar:!0,showToday:!0,showTime:!0,showNow:!0,militaryTime:!1,min:null,max:null},ko.utils.extend(b.opts,a),b.opts.calendar||b.opts.showTime?(b.strings={months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],time:["AM","PM"]},b.constants={daysInWeek:7,dayStringLength:2},b.utils={date:{normalize:function(a){var b=new Date(a.getTime());return b.setHours(0,0,0,0),b},isSame:function(a,b){return a&&b?a.getMonth()==b.getMonth()&&a.getDate()==b.getDate()&&a.getFullYear()==b.getFullYear():!1},isSameMonth:function(a,b){return a&&b?a.getMonth()==b.getMonth():!1},isWeekend:function(a){return a?0===a.getDay()||a.getDay()==b.constants.daysInWeek-1:!1},isWithinMinMaxDateRange:function(a){return a?b.opts.min||b.opts.max?b.opts.min&&b.utils.date.normalize(b.opts.min)>a?!1:b.opts.max&&b.utils.date.normalize(b.opts.max)<a?!1:!0:!0:!1}},time:{handleSuffixCheck:function(a){var b=a.getHours();return b>=12?b-=12:12>b&&(b+=12),a.setHours(b)},checkMinTimeRange:function(a){if(!a||!b.selected()||!b.opts.min&&!b.opts.max)return!1;var c=new Date(b.selected());return"hours"===a.type?c.setHours(c.getHours()-1):"minutes"===a.type?c.setMinutes(c.getMinutes()-1):"suffix"===a.type&&(c=b.utils.time.handleSuffixCheck(c)),b.opts.max&&b.opts.max<c?!0:b.opts.min&&b.opts.min>c?!0:!1},checkMaxTimeRange:function(a){if(!a||!b.selected()||!b.opts.min&&!b.opts.max)return!1;var c=new Date(b.selected());return"hours"===a.type?c.setHours(c.getHours()+1):"minutes"===a.type?c.setMinutes(c.getMinutes()+1):"suffix"===a.type&&(c=new Date(b.utils.time.handleSuffixCheck(c))),b.opts.min&&b.opts.min>c?!0:b.opts.max&&b.opts.max<c?!0:!1}},strings:{pad:function(a){return 10>a?"0"+a:a}},element:{offset:function(a){var b=a.getBoundingClientRect(),c=document.documentElement;return{top:b.top+window.pageYOffset-c.clientTop,left:b.left+window.pageXOffset-c.clientLeft}},height:function(a){return a.offsetHeight},isDescendant:function(a,b){for(var c=b.parentNode;null!==c;){if(c==a)return!0;c=c.parentNode}return!1}}},b.current=ko.observable(b.opts.current||new Date),b.selected=ko.observable(b.opts.selected),b.selected.subscribe(b.opts.value),b.opts.value(b.opts.selected),b.opts.showToday&&!b.utils.date.isWithinMinMaxDateRange(b.utils.date.normalize(new Date))&&(b.opts.showToday=!1),b.opts.showNow&&(b.opts.min&&b.opts.min>=new Date||b.opts.max&&b.opts.max<=new Date)&&(b.opts.showNow=!1),b.calendar={select:function(a){return b.opts.deselectable&&b.utils.date.isSame(b.selected(),a)?b.selected(null):void b.selected(new Date(b.opts.min&&b.utils.date.isSame(a,b.opts.min)?b.opts.min:a))},selectToday:function(){var a=b.utils.date.normalize(new Date);b.calendar.select(a),b.current(a)},next:function(){b.current(new Date(b.current().setMonth(b.current().getMonth()+1)))},prev:function(){b.current(new Date(b.current().setMonth(b.current().getMonth()-1)))},sheet:ko.computed(function(){var a=b.utils.date.normalize(b.current());a.setDate(1),a.setDate(a.getDate()-a.getDay());for(var c=[],d=0,e=!1,f=!1,g=!1;;){if(c[d]||(c[d]=[]),c[d].length!==b.constants.daysInWeek&&(c[d].push(new Date(a.getTime())),a.setDate(a.getDate()+1)),a.getMonth()==b.current().getMonth()&&(e=!0),e&&a.getMonth()!==b.current().getMonth()&&(f=!0),f&&c[d].length==b.constants.daysInWeek&&(g=!0),f&&g)break;c[d].length==b.constants.daysInWeek&&d++}return c})},b.time={next:function(a){return b.selected()?void b.selected(new Date(a.set(a.get()+1))):b.time.selectNow()},prev:function(a){return b.selected()?void b.selected(new Date(a.set(a.get()-1))):b.time.selectNow()},selectNow:function(){var a=new Date;b.selected(a),b.current(a)},sheet:ko.observableArray([{type:"hours",get:function(){return b.selected().getHours()},set:function(a){return b.selected().setHours(a)}},{type:"minutes",get:function(){return b.selected().getMinutes()},set:function(a){return b.selected().setMinutes(a)}}]),text:function(a){if(!b.selected())return"-";switch(a.type){case"suffix":return a.get()?b.strings.time[1]:b.strings.time[0];case"hours":var c=a.get();return!b.opts.militaryTime&&(c>12||0===c)&&(c-=12),Math.abs(c);default:return b.utils.strings.pad(a.get())}}},b.opts.militaryTime||b.time.sheet.push({type:"suffix",get:function(){return b.selected()&&b.selected().getHours()<12?0:1},set:function(){var a=b.selected().getHours();return a>=12?a-=12:12>a&&(a+=12),b.selected().setHours(a)}}),void(b.visible=ko.observable(!0))):void console.error("Silly goose, what are you using ko-calendar for?")},c='<div class="ko-calendar" data-bind="with: $data, visible: (opts.showCalendar || opts.showTime) && visible()">			<!-- ko if: opts.showCalendar -->			<table data-bind="css: { selected: selected } " class="calendar-sheet">				<thead>					<tr>						<th>							<a href="#" data-bind="click: calendar.prev" class="prev">&laquo;</a>						</th>						<th data-bind="attr: { colspan: constants.daysInWeek - 2 } ">							<b data-bind="text: strings.months[current().getMonth()] + \' \' + current().getFullYear()"></b>						</th>						<th>							<a href="#" data-bind="click: calendar.next" class="next">&raquo;</a>						</th>					</tr>					<tr data-bind="foreach: strings.days">						<th data-bind="text: $data.substring(0, $parents[1].constants.dayStringLength)"></th>					</tr>				</thead>				<tbody data-bind="foreach: calendar.sheet">					<tr class="week" data-bind="foreach: $data">						<td class="day" data-bind="css: { weekend: $parents[1].utils.date.isWeekend($data), today: $parents[1].utils.date.isSame(new Date(), $data), inactive: !($parents[1].utils.date.isSameMonth($parents[1].current(), $data)), outofrange: !($parents[1].utils.date.isWithinMinMaxDateRange($data)) } ">							<a href="javascript:;" data-bind="text: $data.getDate(), attr: { title: $data }, click: $parents[1].calendar.select, css: { active: $parents[1].utils.date.isSame($parents[1].selected(), $data) } "></a>						</td>					</tr>				</tbody>				<!-- ko if: opts.showToday -->					<tfoot>						<tr>							<td data-bind="attr: { colspan: constants.daysInWeek } ">								<a href="javascript:;" data-bind="click: calendar.selectToday">Today</a>							</td>						</tr>					</tfoot>				<!-- /ko -->			</table>			<!-- /ko -->			<!-- ko if: opts.showTime -->			<table class="time-sheet">				<tbody>					<tr data-bind="foreach: time.sheet">						<td data-bind="css: { outofrange: $parent.utils.time.checkMaxTimeRange($data) }">							<a href="#" class="up" data-bind="click: $parent.time.next"></a>						</td>					</tr>					<tr data-bind="foreach: time.sheet">						<td data-bind="css: { colon: $index() === 0, inactive: !$parent.selected() }, text: $parent.time.text($data)"></td>					</tr>					<tr data-bind="foreach: time.sheet">						<td data-bind="css: { outofrange: $parent.utils.time.checkMinTimeRange($data) }">							<a href="#" class="down" data-bind="click: $parent.time.prev"></a>						</td>					</tr>				</tbody>				<!-- ko if: opts.showNow -->					<tfoot>						<tr>							<td data-bind="attr: { colspan: time.sheet().length } ">								<a href="javascript:;" data-bind="click: time.selectNow">Now</a>							</td>						</tr>					</tfoot>				<!-- /ko -->			</table>			<!-- /ko -->		</div>';ko.components.register(a,{viewModel:b,template:c}),ko.bindingHandlers[a]={init:function(a,d){var e,f=ko.unwrap(d()),g=new b(f);if("INPUT"==a.tagName){var h=document.createElement("div");h.innerHTML=c,e=h.children[0],a.parentNode.insertBefore(e,a.nextSibling),g.visible(!1),ko.utils.registerEventHandler(a,"focus",function(){var b=g.utils.element.offset(a),c=g.utils.element.height(a);e.style.position="absolute",e.style.top=b.top+c+5+"px",e.style.left=b.left+"px",g.visible(!0)}),ko.utils.registerEventHandler(document,"mousedown",function(b){b.target==a||b.target==e||g.utils.element.isDescendant(e,b.target)?a.focus():g.visible(!1)})}else e=a.children[0];return a.innerHTML=c,ko.applyBindings(g,e),{controlsDescendantBindings:!0}}}}).call(this);