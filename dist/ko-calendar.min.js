/*! ko-calendar.js v0.2.2 */
(function(a,b){var c="calendar",d={deepExtend:function(a,b){var c;for(c in b)b[c]&&b[c].constructor&&b[c].constructor===Object?(a[c]=a[c]||{},d.deepExtend(a[c],b[c])):a[c]=b[c];return a}},e=function(e){var f=this;return f.opts={value:ko.observable(),current:new Date,deselectable:!0,showCalendar:!0,showToday:!0,showTime:!0,showNow:!0,militaryTime:!1,min:null,max:null,autoclose:!0,strings:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],time:["AM","PM"]}},d.deepExtend(f.opts,e),f.opts.showCalendar||f.opts.showTime?(f.constants={daysInWeek:7,dayStringLength:2},f.utils={date:{normalize:function(a){var b=new Date(a.getTime());return b.setHours(0,0,0,0),b},isSame:function(a,b){return a&&b?a.getMonth()==b.getMonth()&&a.getDate()==b.getDate()&&a.getFullYear()==b.getFullYear():!1},isSameMonth:function(a,b){return a&&b?a.getMonth()==b.getMonth():!1},isWeekend:function(a){return a?0===a.getDay()||a.getDay()==f.constants.daysInWeek-1:!1},isWithinMinMaxDateRange:function(a){return a?f.opts.min||f.opts.max?f.opts.min&&f.utils.date.normalize(f.opts.min)>a?!1:f.opts.max&&f.utils.date.normalize(f.opts.max)<a?!1:!0:!0:!1}},time:{handleSuffixCheck:function(a){var b=a.getHours();return b>=12?b-=12:12>b&&(b+=12),a.setHours(b)},checkMinTimeRange:function(a){if(!a||!f.value()||!f.opts.min&&!f.opts.max)return!1;var b=new Date(f.value());return"hours"===a.type?b.setHours(b.getHours()-1):"minutes"===a.type?b.setMinutes(b.getMinutes()-1):"suffix"===a.type&&(b=f.utils.time.handleSuffixCheck(b)),f.opts.max&&f.opts.max<b?!0:f.opts.min&&f.opts.min>b?!0:!1},checkMaxTimeRange:function(a){if(!a||!f.value()||!f.opts.min&&!f.opts.max)return!1;var b=new Date(f.value());return"hours"===a.type?b.setHours(b.getHours()+1):"minutes"===a.type?b.setMinutes(b.getMinutes()+1):"suffix"===a.type&&(b=new Date(f.utils.time.handleSuffixCheck(b))),f.opts.min&&f.opts.min>b?!0:f.opts.max&&f.opts.max<b?!0:!1}},strings:{pad:function(a){return 10>a?"0"+a:a}},element:{offset:function(c){var d=c.getBoundingClientRect(),e=b.documentElement;return{top:d.top+a.pageYOffset-e.clientTop,left:d.left+a.pageXOffset-e.clientLeft}},height:function(a){return a.offsetHeight},isDescendant:function(a,b){for(var c=b.parentNode;null!==c;){if(c==a)return!0;c=c.parentNode}return!1}}},f.current=ko.observable(f.opts.current||new Date),ko.isObservable(f.opts.value)?(f.value=f.opts.value,f.opts.showToday&&!f.utils.date.isWithinMinMaxDateRange(f.utils.date.normalize(new Date))&&(f.opts.showToday=!1),f.opts.showNow&&(f.opts.min&&f.opts.min>=new Date||f.opts.max&&f.opts.max<=new Date)&&(f.opts.showNow=!1),f.calendar={select:function(a){return f.opts.deselectable&&f.utils.date.isSame(f.value(),a)?f.value(null):(f.value(f.opts.min&&f.utils.date.isSame(a,f.opts.min)?new Date(f.opts.min):new Date(a)),void(f.input()&&f.opts.autoclose&&f.visible(!1)))},selectToday:function(){var a=f.utils.date.normalize(new Date);f.calendar.select(a),f.current(a)},next:function(){var a=f.current();a.setDate(1),a.setMonth(a.getMonth()+1),f.current(new Date(a))},prev:function(){var a=f.current();a.setDate(1),a.setMonth(a.getMonth()-1),f.current(new Date(a))},sheet:ko.computed(function(){var a=f.utils.date.normalize(f.current());a.setDate(1),a.setDate(a.getDate()-a.getDay());for(var b=[],c=0,d=!1,e=!1,g=!1;;){if(b[c]||(b[c]=[]),b[c].length!==f.constants.daysInWeek&&(b[c].push(new Date(a.getTime())),a.setDate(a.getDate()+1)),a.getMonth()==f.current().getMonth()&&(d=!0),d&&a.getMonth()!==f.current().getMonth()&&(e=!0),e&&b[c].length==f.constants.daysInWeek&&(g=!0),e&&g)break;b[c].length==f.constants.daysInWeek&&c++}return b})},f.time={next:function(a){return f.value()?void f.value(new Date(a.set(a.get()+1))):f.time.selectNow()},prev:function(a){return f.value()?void f.value(new Date(a.set(a.get()-1))):f.time.selectNow()},selectNow:function(){var a=new Date;f.value(a),f.current(a),f.input()&&f.opts.autoclose&&f.visible(!1)},sheet:ko.observableArray([{type:"hours",get:function(){return f.value().getHours()},set:function(a){return f.value().setHours(a)}},{type:"minutes",get:function(){return f.value().getMinutes()},set:function(a){return f.value().setMinutes(a)}}]),text:function(a){if(!f.value())return"-";switch(a.type){case"suffix":return a.get()?f.opts.strings.time[1]:f.opts.strings.time[0];case"hours":var b=a.get();return!f.opts.militaryTime&&(b>12||0===b)&&(b-=12),Math.abs(b);default:return f.utils.strings.pad(a.get())}}},f.opts.militaryTime||f.time.sheet.push({type:"suffix",get:function(){return f.value()&&f.value().getHours()<12?0:1},set:function(){var a=f.value().getHours();return a>=12?a-=12:12>a&&(a+=12),f.value().setHours(a)}}),f.input=ko.observable(!1),void(f.visible=ko.observable(!0))):console.error("value must be an observable")):console.error("Silly goose, what are you using ko-%s for?",c)},f='<div class="ko-calendar" data-bind="with: $data, visible: (opts.showCalendar || opts.showTime) && visible(), attr: { \'data-opts\': JSON.stringify(opts) } ">			<!-- ko if: opts.showCalendar -->			<table data-bind="css: { selected: value } " class="calendar-sheet">				<thead>					<tr class="month-header">						<th>							<a href="#" data-bind="click: calendar.prev" class="prev">&laquo;</a>						</th>						<th data-bind="attr: { colspan: constants.daysInWeek - 2 } ">							<b data-bind="text: opts.strings.months[current().getMonth()] + \' \' + current().getFullYear()"></b>						</th>						<th>							<a href="#" data-bind="click: calendar.next" class="next">&raquo;</a>						</th>					</tr>					<tr data-bind="foreach: opts.strings.days">						<th data-bind="text: $data.substring(0, $parents[1].constants.dayStringLength)"></th>					</tr>				</thead>				<tbody data-bind="foreach: calendar.sheet">					<tr class="week" data-bind="foreach: $data">						<td class="day" data-bind="css: { weekend: $parents[1].utils.date.isWeekend($data), today: $parents[1].utils.date.isSame(new Date(), $data), inactive: !($parents[1].utils.date.isSameMonth($parents[1].current(), $data)), outofrange: !($parents[1].utils.date.isWithinMinMaxDateRange($data)) } ">							<a href="javascript:;" data-bind="text: $data.getDate(), attr: { title: $data }, click: $parents[1].calendar.select, css: { active: $parents[1].utils.date.isSame($parents[1].value(), $data) } "></a>						</td>					</tr>				</tbody>				<!-- ko if: opts.showToday -->					<tfoot>						<tr>							<td data-bind="attr: { colspan: constants.daysInWeek } ">								<a href="javascript:;" data-bind="click: calendar.selectToday">Today</a>							</td>						</tr>					</tfoot>				<!-- /ko -->			</table>			<!-- /ko -->			<!-- ko if: opts.showTime -->			<table class="time-sheet">				<tbody>					<tr data-bind="foreach: time.sheet">						<td data-bind="css: { outofrange: $parent.utils.time.checkMaxTimeRange($data) }">							<a href="#" class="up" data-bind="click: $parent.time.next"></a>						</td>					</tr>					<tr data-bind="foreach: time.sheet">						<td data-bind="css: { colon: $index() === 0, inactive: !$parent.value() }, text: $parent.time.text($data)"></td>					</tr>					<tr data-bind="foreach: time.sheet">						<td data-bind="css: { outofrange: $parent.utils.time.checkMinTimeRange($data) }">							<a href="#" class="down" data-bind="click: $parent.time.prev"></a>						</td>					</tr>				</tbody>				<!-- ko if: opts.showNow -->					<tfoot>						<tr>							<td data-bind="attr: { colspan: time.sheet().length } ">								<a href="javascript:;" data-bind="click: time.selectNow">Now</a>							</td>						</tr>					</tfoot>				<!-- /ko -->			</table>			<!-- /ko -->		</div>',g=function(a,c){var d,g=new e(c);if("INPUT"==a.tagName){var h=b.createElement("div");h.innerHTML=f,d=h.children[0],b.body.appendChild(d),g.input(!0),g.visible(!1),ko.utils.registerEventHandler(a,"focus",function(){var b=g.utils.element.offset(a),c=g.utils.element.height(a);d.style.position="absolute",d.style.top=b.top+c+5+"px",d.style.left=b.left+"px",g.visible(!0)}),ko.utils.registerEventHandler(a,"keydown",function(a){9==a.which&&g.visible(!1)}),ko.utils.registerEventHandler(b,"mousedown",function(b){b.target==a||b.target==d||g.utils.element.isDescendant(d,b.target)?a.focus():g.visible(!1)})}else a.innerHTML=f,d=a.children[0];ko.applyBindings(g,d)};ko.components.register(c,{viewModel:e,template:f}),ko.bindingHandlers[c]={init:function(a,b){return g(a,ko.unwrap(b())),{controlsDescendantBindings:!0}}},ko[c]=g}).call(this,window,document);